<html>
<head>
    <title></title>
    <script src="engine.js"></script>
    <script>
        /// <reference path = "engine.js" />
        var selectedTable = undefined;

        var testDoc = {
            type: "document",
            args: [
            {
                type: "native",
                name: "alert ",
                "native": alert,
				hasSideEffects:true,
                args: [
                {
                    type: "native",
                    name: ["", " + "],
                    "native": add,
                    args: [
                        {
                            type: "native",
                            name: ["", " + "],
                            "native": add,
                            args: [
                                {
                                    type: "literal",
                                    literal: 77
                                },
                                {
                                    type: "literal",
                                    literal: 88
                                }
                            ]
                        },
                        {
                            type: "native",
                            name: ["", " + "],
                            "native": add,
                            args: [
                                {
                                    type: "literal",
                                    literal: 55
                                },
                                {
                                    type: "literal",
                                    literal: 66
                                }
                            ]
                        }
                    ]
                }]
            }
            ]
        };

        var paletteEntries = {
            type: "document",
            args: [
            {
                type: "declareBlockTemplate",
                name: ["declare ", " returns "],
				run: false,
                args: [
					{
                        type: "functionDeclarePlaceholder",
                        name: "function",
						args:[
							{
								type: "varDeclarePlaceholder",
								name: "arg",
								local: true,
							},
						],
                    },
					{
						type: "literal",
						literal: ""
					},
                ]
            },
			{
                type: "declareBlockTemplate",
                name: ["declare ", " = "],
				run: false,
                args: [
					{
						type: "varDeclarePlaceholder",
						name: "constant",
						local: true,
						mutable:false,
                    },
					{
						type: "literal",
						literal: ""
					},
                ]
            },
			{
                type: "declareBlockTemplate",
                name: ["declare ", " = "],
				run: false,
                args: [
					{
						type: "varDeclarePlaceholder",
						name: "variable",
						local: true,
						mutable:true,
                    },
					{
						type: "literal",
						literal: ""
					},
                ]
            },
            {
                type: "nativeTemplate",
                name: "alert ",
                "native": alert,
				hasSideEffects:true,
                args: [{ type: "literal", literal: "Hello" }]
            },
            {
                type: "nativeTemplate",
                native: function(entry, value){ entry.scope[entry.key] = value; },
                name: ["set ", " = "],
				lvalue: [true, false],
				hasSideEffects:true,
				args: [
                    createEmptyVariableNode(),
					createLiteralNode(0),
                ]
            },
			{
                type: "nativeTemplate",
                native: ask,
                name: ["ask ", " and wait"],
				hasSideEffects: true,
                args: [
                    {
                        type: "literal",
                        literal: "What's your name?"
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " + "],
                "native": add,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " - "],
                "native": sub,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " * "],
                "native": mul,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " / "],
                "native": div,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["pick random from ", " to "],
                "native": rand,
                args: [
                    {
                        type: "literal",
                        literal: 1
                    },
                    {
                        type: "literal",
                        literal: 10
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " < "],
                "native": lt,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " = "],
                native: eq,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
            {
                type: "nativeTemplate",
                name: ["", " > "],
                "native": gt,
                args: [
                    {
                        type: "literal",
                        literal: ""
                    },
                    {
                        type: "literal",
                        literal: ""
                    }
                ]
            },
			{
                type: "nativeTemplate",
                native: function(cond, then, els){ if(run(cond)){ return run(then)} else { return run(els)} },
                name: ["if ", " then ", " else "],
				run: false,
				args: [
					createLiteralNode(0),
					createLiteralNode(0),
					createLiteralNode(0),
                ]
            }
		]};
		
		function ScopeEntry(name, value)
		{
			this.name = name;
			this._value = value;
		}
		
		ScopeEntry.prototype = {
			get value() {
				return this._value;
			},
			
			set value(v) {
				this._value = v;
				if(this.domNode !== undefined)
				{
					this.domNode.textBox.value = v;
				}
			},
		};
		
		var localscope = [
			new ScopeEntry("length", 15)
		];

        function addParents(tree)
		{
            function addParentsRec(current, parent)
			{
                current.parent = parent;
                if (current.args !== undefined)
				{
                    for (var Idx = 0; Idx < current.args.length; ++Idx)
					{
                        addParentsRec(current.args[Idx], current);
                    }
                }
            };

            addParentsRec(tree, undefined);
        }

        function onclick_tableId(cell)
		{
            if (selectedTable != undefined)
			{
                // restore default settings
                selectedTable.className = "sctable";
                selectedTable.draggable = false;
                var headerElement = selectedTable.firstChild.firstChild;
                while (headerElement !== null) {
                    if (headerElement.nodeName === "TD") {
                        headerElement.draggable = true;
                    }
                    headerElement = headerElement.nextSibling;
                }
            }
            selectedTable = merge(cell.parentNode.parentNode,
                {
                    className: "sctable_moving",
                    draggable: true
                });

            var headerElement = selectedTable.firstChild.firstChild;
            while (headerElement !== null)
			{
                if (headerElement.nodeName === "TD")
				{
                    headerElement.draggable = false;
                }
                headerElement = headerElement.nextSibling;
            }
        }

        /*document.addEventListener("dragover", function (event)
        {
            event.preventDefault();
        });

        document.addEventListener("drop", function (event)
        {
            event.preventDefault();
        /*    if (event.target.className == "droptarget")
            {
                document.getElementById("demo").style.color = "";
                event.target.style.border = "";
                var data = event.dataTransfer.getData("Text");
                event.target.appendChild(document.getElementById(data));
            }* /
        });*/

        function onload_init()
		{
            var scratchArea = document.getElementById("scratch_area");
			displayScratchArea();
            scratchArea.ondrop = placeDrop;
            scratchArea.ondragover = allowDrop;

            var paletteArea = document.getElementById("palette_area");
            displayWholePage(paletteEntries, paletteArea);
            paletteArea.ondrop = deleteDrop;
            paletteArea.ondragover = allowDrop;
			
			var dataArea = document.getElementById("data_area");
			displayData(localscope, dataArea);
        }

		function displayScratchArea()
		{
			var scratchArea = document.getElementById("scratch_area");
            displayWholePage(testDoc, scratchArea); // redisplay
		}
		
        function displayWholePage(node, rootElement)
		{
            addParents(node);

            removeAllChildren(rootElement);
            rootElement.appendChild(representScratchNode(node));
        }
		
		function displayData(scope, rootElement)
		{
			removeAllChildren(rootElement);
			for(var Idx = 0; Idx < scope.length; ++Idx)
			{
				rootElement.appendChild(representScopeEntry(scope[Idx]));
			}
		}

        function removeAllChildren(element)
		{
            while (element.firstChild !== null)
			{
                element.removeChild(element.firstChild);
            }
        }

        function representScratchNode(scratchNode)
		{
            var newElement;
            switch (scratchNode.type)
			{
                case "document":
                    newElement = document.createElement("DIV");
                    for (var Idx = 0; Idx < scratchNode.args.length; ++Idx)
					{
                        var containerDiv = document.createElement("DIV");
                        containerDiv.appendChild(representScratchNode(scratchNode.args[Idx]));
                        newElement.appendChild(containerDiv);
                    }
                    break;

                case "native":
				case "nativeTemplate":
				case "functionCall":
				case "getvar":
				case "refvar":
				case "declareBlock":
				case "declareBlockTemplate":
                    newElement = merge(document.createElement("DIV"),
                        {
                            draggable: true,
                            ondragstart: drag
                        });
						
					switch(scratchNode.type)
					{
						case "declareBlock":
						case "declareBlockTemplate":
							newElement.className = "declareBlock";
							break;
						case "refvar":
							newElement.className = "mutableNativeNode";
							break;
						case "getvar":
							newElement.className = "nativeLeaf";
						default:
							if(scratchNode.hasSideEffects)
								newElement.className = "commandNode";
							else if(scratchNode.args === undefined || scratchNode.args.length === 0)
								newElement.className = "nativeLeaf";
							else
								newElement.className = "nativeNode";
							break;
					}
						
					var template = scratchNode;
					if(scratchNode.template !== undefined)
						template = scratchNode.template;

					var textList = template.name;
					var textList = textList ? (typeof textList === 'string' ? [textList] : textList) : [];

					newElement.appendChild( document.createTextNode(textList[0]) );

					if(scratchNode.args !== undefined && scratchNode.args.length > 0)
					{
						for(var Idx = 0; Idx < scratchNode.args.length; ++Idx)
						{
							newElement.appendChild( representScratchNode(scratchNode.args[Idx]) );
							if(textList[Idx+1] !== undefined)
							{
								newElement.appendChild( document.createTextNode(textList[Idx+1]) );
							}
						}
					}
                    break;
                case "literal":
                    newElement = merge(document.createElement("INPUT"),
                        {
                            type: 'text',
                            className: 'numberField',
                            value: scratchNode.literal,
                            size: 3,
                            onchange: function () {
                                var $t;
                                this.scratchNode.literal = (($t = parseFloat(this.value)) ? $t : this.value);
                                this.size = this.value.length > 6 ? 20 : 3;
                            },
                            onkeyup: function () {
                                this.size = this.value.length > 6 ? 20 : 3;
                            }
                        });
                    break;
					
				case "variableSlot":
                    newElement = merge(document.createElement("DIV"),
						{
							className: 'variableField',
						});
					break;

				case "functionDeclarePlaceholder":
                    newElement = merge(document.createElement("DIV"),
						{
							className: 'templateField',
						});
						
					newElement.appendChild( document.createTextNode(scratchNode.name) );
					break;
					
				case "varDeclarePlaceholder":
                    newElement = merge(document.createElement("DIV"),
						{
							className: scratchNode.mutable?'mutableTemplateFieldLeaf':'templateFieldLeaf',
						});
						
					newElement.appendChild( document.createTextNode(scratchNode.name) );
					break;
					
				case "functionDeclare":
				case "varDeclare":
					if(g_expandedNode === scratchNode)
					{
						newElement = merge(document.createElement("DIV"),
							{
								className: 'templateField',
							});
						var nameDiv = document.createElement("DIV");
						nameDiv.appendChild( document.createTextNode(scratchNode.name) );
						newElement.appendChild(nameDiv);
						
						if(scratchNode.args !== undefined)
						{
							for(var Idx = 0; Idx < scratchNode.args.length; ++Idx)
							{
								var argsDiv = document.createElement("DIV");
								argsDiv.style.paddingLeft = 10;
								newElement.appendChild(argsDiv);
								
								argsDiv.appendChild( representScratchNode(scratchNode.args[Idx]) );
							}
						}
					}
					else
					{
						newElement = representDeclarationNode(scratchNode);
					}
					break;
            }

			switch(scratchNode.type)
			{
				case "nativeTemplate":
				case "functionDeclare":
				case "declareBlockTemplate":
					newElement.isTemplate = true;
					break;
				case "varDeclare":
					if(g_expandedNode === scratchNode.parent)
					{
						newElement.isEditableTemplate = true;
					}
					else
					{
						newElement.isTemplate = true;
					}
					break;
				default:
					break;
			}
            newElement.scratchNode = scratchNode;
            return newElement;
        }
		
		function representScopeEntry(scopeEntry)
		{
			var newElement = merge(document.createElement("DIV"),
				{
					className: "scopeEntry",
					draggable: true,
					ondragstart: drag,
					scopeEntry: scopeEntry,
					scratchNode: {
						type: "nativeTemplate",
						scopeEntry: scopeEntry,
						text: scopeEntry.name,
						args:[],
						"native": function(){ return scopeEntry.value; },
						"nativeLValue": function(){ return { scope:scopeEntry, key:"value" }; },
					}
				});

			newElement.appendChild( document.createTextNode(scopeEntry.name) );
				
			var textBox = merge(document.createElement("INPUT"),
				{
					type: 'text',
					className: 'numberField',
					value: scopeEntry.value,
					scopeEntry: scopeEntry,
					size: 3,
					onchange: function () {
						var $t;
						this.scopeEntry.value = (($t = parseInt(this.value)) ? $t : this.value);
						this.size = this.value.length > 6 ? 20 : 3;
					},
					onkeyup: function () {
						this.size = this.value.length > 6 ? 20 : 3;
					}
				});

			newElement.appendChild(textBox);
			newElement.textBox = textBox;
			scopeEntry.domNode = newElement;
			return newElement;
		}
		
		function representDeclarationNode(scratchNode)
		{
			var newNode;
			var editableSpan = merge(document.createElement("SPAN"),
				{
					contentEditable: false,
					scratchNode: scratchNode,
					onblur: function()
					{
						this.contentEditable = false;
					},
					onclick: function()
					{
						if(this.contentEditable === "true")
						{
							this.contentEditable = false;
							window.getSelection().removeAllRanges();
						}
						else
						{
							this.contentEditable = true;
							this.focus();
							selectElementContents(this);
						}
					},
					oninput: function()
					{
						this.scratchNode.name = this.innerText;
					}
				});
			newNode = merge(document.createElement("DIV"),
				{
					className: 'templateField',
					draggable: true,
					ondragstart: drag,
				});
			newNode.appendChild(editableSpan);
			editableSpan.appendChild( document.createTextNode(scratchNode.name) );
			
			if(scratchNode.args === undefined || scratchNode.args.length === 0)
			{
				newNode.className = scratchNode.mutable?"mutableTemplateFieldLeaf": "templateFieldLeaf";
			}
			else if(scratchNode.args !== undefined)
			{
				for(var Idx = 0; Idx < scratchNode.args.length; ++Idx)
				{
					newNode.appendChild( representScratchNode(scratchNode.args[Idx]) );
				}
			}
			
			if(scratchNode.type === "functionDeclare")
			{	
				var contextMenuSpan = merge(document.createElement("SPAN"),
				{
					onclick:function()
					{
						showContextMenu(this, [
							{ text:"Add Parameter", action:function(){
								scratchNode.args.push({
									type:"varDeclare",
									name:"arg"+(scratchNode.args.length+1),
									local:true
								});
								displayScratchArea();
							} },
							{ text:"Edit Parameters", action:function(){
								g_expandedNode = scratchNode;
								displayScratchArea();
							} },
						]);
					},
				});
				contextMenuSpan.appendChild( document.createTextNode("â–¼") );
				newNode.appendChild(contextMenuSpan);
			}
			return newNode;
		}

        var g_draggingElement;
		var g_expandedNode;

        function drag(ev)
		{
            g_draggingElement = ev.target;
        }

        function getRoot(node)
		{
            while (node.parent !== undefined)
                node = node.parent;

            return node;
        }

        function cloneNode(node, resolvingParent)
		{
            checkTypes([node], ['object']);
            var result = {};
			var resolvingTemplate = false;
            
			switch(node.type)
			{
				case "nativeTemplate":
					result.type = "native";
					break;
				case "functionDeclarePlaceholder":
					result.type = "functionDeclare";
					break;
				case "functionDeclare":
					result.type = "functionCall";
					result.template = node;
					resolvingTemplate = true;
					break;
				case "declareBlockTemplate":
					result.type = "declareBlock";
					break;
				case "varDeclarePlaceholder":
					result.type = "varDeclare";
					break;
				case "varDeclare":
					if(resolvingParent) //is this a parameter in a function declaration, and we're dragging out a function call from it?
					{
						return { type:"literal", literal:"" };
					}
					else if(node.mutable)
					{
						result.type = "refvar";
						result.template = node;
					}
					else
					{
						result.type = "getvar";
						result.template = node;
					}
					break;
				default:
					result.type = node.type;
					break;
			}

			for (var key in node)
			{
                if (key === "parent" || key === "type")
                    continue;
                var value = node[key];
                result[key] = isArray(value) ? value.map(function (v) {
                    return typeof v !== 'object' ? v : cloneNode(v, resolvingTemplate);
                }) : value;
            }
			
            return result;
        }

        function placeDrop(ev)
		{
            if (g_draggingElement === undefined)
				return;

			if(g_draggingElement.scratchNode !== undefined)
			{
                var draggingNode = g_draggingElement.scratchNode;
                var targetNode = ev.target.scratchNode;
                var draggingRoot = getRoot(draggingNode);
				
				if(g_draggingElement.isEditableTemplate)
				{
					// we're reordering or removing function parameters
					if(targetNode === undefined)
					{
						var draggedArgIdx = getParentArgIndex(draggingNode);
						draggingNode.parent.args.splice(draggedArgIdx, 1);
						displayScratchArea();
					}
					else if(targetNode.parent === draggingNode.parent)
					{
						var draggedArgIdx = getParentArgIndex(draggingNode);
						draggingNode.parent.args.splice(draggedArgIdx, 1);
						var targetArgIdx = getParentArgIndex(targetNode);
						targetNode.parent.args.splice(targetArgIdx, 0, draggingNode);
						displayScratchArea();
					}
					else if(targetNode === draggingNode.parent)
					{
						var draggedArgIdx = getParentArgIndex(draggingNode);
						draggingNode.parent.args.splice(draggedArgIdx, 1);
						targetNode.parent.args.push(draggingNode);
						displayScratchArea();
					}
					return;
				}
				
				switch(targetNode !== undefined ? targetNode.type: "")
				{
					// can't drag anything onto templates
					case "nativeTemplate":
					case "functionDeclare":
					case "functionDeclarePlaceholder":
					case "declareBlockTemplate":
					case "varDeclarePlaceholder":
						return;
					case "varDeclare":
						if(draggingNode.type === "varDeclare")
						{
							if(targetNode.parent === draggingNode.parent)
							{
								var draggedArgIdx = getParentArgIndex(draggingNode);
								draggingNode.parent.args.splice(draggedArgIdx, 1);
								var targetArgIdx = getParentArgIndex(targetNode);
								targetNode.parent.args.splice(targetArgIdx, 0, draggingNode);
								displayScratchArea();
								return;
							}
						}
						return;
				}

				if(g_draggingElement.isTemplate)
				{
					// dragged a template, so clone it
					draggingNode = cloneNode(draggingNode);
                }

                if (targetNode === undefined)
				{
                    // dragged a node into nowhere, add it to the root doc
                    if (draggingNode.parent !== testDoc)
					{
                        dragAwayNode(draggingNode);

                        testDoc.args.push(draggingNode);
						displayScratchArea();
                    }
                }
                else if (targetNode.parent !== undefined && !isAncestorOfNode(draggingNode, targetNode))
				{
                    dragAwayNode(draggingNode);

                    var targetArgIdx = getParentArgIndex(targetNode);

                    var replacedNode = targetNode.parent.args[targetArgIdx];					
                    targetNode.parent.args[targetArgIdx] = draggingNode;

                    if (replacedNode !== undefined && replacedNode.type !== "literal" && replacedNode.type !== "variableSlot")
					{
                        testDoc.args.push(replacedNode);
                    }
					displayScratchArea();
                }

                g_draggingElement = undefined;
            }
        }
	
        function dragAwayElement(element)
		{
			var draggingNode = element.scratchNode;
			if(element.isTemplate)
			{
				if(draggingNode.type === "varDeclare" && draggingNode.parent.type === "functionDeclare")
				{
					// remove function argument
					var draggedArgIdx = getParentArgIndex(draggingNode);
					draggingNode.parent.args.splice(draggedArgIdx, 1);
					displayScratchArea();
				}
				return;
			}
				
			dragAwayNode(element.scratchNode);
		}

        function dragAwayNode(node)
		{
            if (node.parent === undefined)
                return;
			
            var draggedArgIdx = getParentArgIndex(node);
            if (node.parent === testDoc)
			{
                node.parent.args.splice(draggedArgIdx, 1);
            }
            else if(node.parent.lvalue !== undefined && node.parent.lvalue[draggedArgIdx])
			{
                node.parent.args[draggedArgIdx] = createEmptyVariableNode();
			}
			else
			{
                node.parent.args[draggedArgIdx] = createLiteralNode(0);
            }
        }

        function isAncestorOfNode(ancestor, node)
		{
            do if (ancestor === node)
                return true;
            while ((node = node.parent) !== undefined);

            return false;
        }

        function createLiteralNode(value)
		{
            return {
                type: "literal",
                literal: value
            };
        }

		function createEmptyVariableNode()
		{
            return {
                type: "variableSlot",
                literal: ""
            };
        }

        function getParentArgIndex(targetNode)
		{
            if (!targetNode.parent) return undefined;
            var index = targetNode.parent.args.indexOf(targetNode);
            return index === -1 ? undefined : index;
        }

        function allowDrop(ev)
		{
            ev.preventDefault();
        }

        function deleteDrop(ev)
		{
            dragAwayElement(g_draggingElement);
			displayScratchArea();
        }

        function onclick_Run()
		{
            var compiled = compile(
                {
                    globalVariables: [],
                    events: [{
                        name: 'greenflag',
                        data: [],
                        body: testDoc.args
                    }]
                }
            );
            runProgram(compiled);
        }
		
		function onclick_AddVariable()
		{
			localscope.push({name:"var"+localscope.length, type:"int", value:0});
			
			var dataArea = document.getElementById("data_area");
			displayData(localscope, dataArea);
		}
		
		function selectElementContents(el)
		{
			var range = document.createRange();
			range.selectNodeContents(el);
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(range);
		}
		
		function showContextMenu(fromElement, items)
		{
			var contextMenu = document.getElementById("context_menu");
			removeAllChildren(contextMenu);
			var rect = fromElement.getBoundingClientRect();
			contextMenu.style.top = rect.bottom;
			contextMenu.style.left = rect.left;
			contextMenu.style.display = "block";
			
			for(var Idx = 0; Idx < items.length; ++Idx)
			{
				var item = items[Idx];
				
				var contextMenuItem = merge(document.createElement("DIV"), {
					className:"contextMenuItem",
					onclick:item.action
				});
				contextMenuItem.appendChild( document.createTextNode(item.text) );
				contextMenu.appendChild(contextMenuItem);
				
			}
			
			setTimeout(function(){
				document.addEventListener("click", hideContextMenu);
			}, 0);
		}
		
		function hideContextMenu()
		{
			var contextMenu = document.getElementById("context_menu");
			contextMenu.style.display = "none";
			document.removeEventListener("click", hideContextMenu);
		}
		
    </script>
    <style>
        #palette_area {
            height: 600px;
            display: table-cell;
            background-color: beige;
        }

        #scratch_area {
            background-color: #AADDAA;
            height: 600px;
            width: 600px;
            padding: 5px;
            float: left;
        }

		#data_area {
            height: 600px;
            display: table-cell;
            background-color: #FFAAAA;
        }

        .tableId {
            background-color: orange;
            border: outset;
            border-radius: 6px;
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 4px;
            padding-right: 4px;
            cursor: pointer;
        }

        .tableHead {
            background-color: #DDDDDD;
            border-bottom: solid;
            border-right: solid;
            border-width: 1px;
            cursor: pointer;
        }

        .tableLhs {
            background-color: #DDDDDD;
            border-bottom: solid;
            border-right: solid;
            border-width: 1px;
            cursor: pointer;
            text-align: right;
        }

        .tableCell {
            border-bottom: solid;
            border-right: solid;
            border-width: 1px;
            border-color: #AAAAAA;
        }

        .sctable {
            position: absolute;
        }

        .sctable_moving {
            position: absolute;
            border: dotted;
        }

		.scopeEntry {
            background-color: #FFAAAA;
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 4px;
            padding-right: 4px;
            cursor: pointer;
        }
		
		.nativeNode, .nativeLeaf, .declareBlock, .scopeNode, .valueNode, .commandNode, .mutableNativeNode {
            border: outset;
			border-radius:6px;
			padding-top:0px;
			padding-bottom:0px;
			padding-left:4px;
			padding-right:4px;
			cursor:pointer;
			display:inline-block;
			color: #000000;
		}

		/* color scheme idea:
			rvalue: blue, lvalue: orange, type: green.
			Functions are lighter versions -
			rvalue: sky blue, lvalue: cream, type function: pale green.
			Commands are redder versions -
			rvalue: violet, lvalue: red.
			(no commands return types, but they would be brown I guess.)
			Pattern matches?
		*/
        .nativeNode, .declareBlock {
            border-color: #DDEEFF; /*#FFCC66;*/
            background-color: #CCCCFF; /*#FFA500;*/
        }

		.mutableNativeNode {
            border-color: #FF8822;
            background-color: #FF5500;
        }

        .commandNode {
            border-color: #FFCC66;
            background-color: #FFA500;
        }
		
		.nativeLeaf{
			border-color:#AACCFF;
			background-color:#55A5FF;
		}

		.scopeNode{
			border-color:#FF6611;
			background-color:#FF5500;
		}

        .valueNode {
            border-color: #B060B0;
            background-color: #800080;
            color: white;
        }
		
		.declareBlock {
            background-color: #554411;
			border-color: #665544;
            color: white;
		}

        .numberField {
            background-color: white;
            border: inset;
            border-width: 1px;
            border-radius: 2px;
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 4px;
            padding-right: 4px;
            display: inline-block;
        }

        .variableField {
            background-color: #FF5500;
            border: inset;
            border-width: 1px;
            border-radius: 2px;
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 4px;
            padding-right: 4px;
			vertical-align: bottom;
			width:30px;
			height:15px;
            display: inline-block;
        }
		
		.templateField, .templateFieldLeaf, .mutableTemplateFieldLeaf {
            background-color: #CCCCFF; /*#FFA500;*/
			border-color: #DDEEFF; /*#FFCC66;*/
            border: inset;
            border-width: 1px;
            border-radius: 3px;
            padding-top: 0px;
            padding-bottom: 0px;
            padding-left: 2px;
            padding-right: 2px;
			font-weight: bold;
            display: inline-block;
			color: #000000;
        }
		
		.templateFieldLeaf {
			border-color: #AACCFF;
            background-color: #55A5FF;
            padding-left: 4px;
            padding-right: 4px;
		}

		.mutableTemplateFieldLeaf {
            background-color: #FF5500;
			border-color: #FF9999;
            padding-left: 4px;
            padding-right: 4px;
		}
		
		#context_menu {
            background-color: #BBBBDD;
			position:absolute;
			top:0;
			left:0;
            display: none;
			border-color: #CCCCDD;
            border: outset;
            border-width: 1px;
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 1px;
            padding-right: 1px;
			user-select:none;
		}
		
		.contextMenuItem {
            background-color: #BBBBBB;
            padding-left: 2px;
            padding-right: 2px;
            padding-top: 2px;
            padding-bottom: 2px;
		}
		
		.contextMenuItem:hover {
            background-color: #6699FF;
		}
	</style>
</head>
<body onload="onload_init()">
    <table style="width:100%; height:100%">
        <tr>
            <td style="vertical-align:top;">
                <button onclick="onclick_Run()">Run</button>
                <br>
                <div id="palette_area"></div>
            </td>
            <td style="vertical-align:top;">
                <div id="scratch_area"></div>
            </td>
            <td style="vertical-align:top;">
                <button onclick="onclick_AddVariable()">Add Variable</button>
                <div id="data_area"></div>
            </td>
        </tr>
    </table>
	<div id="context_menu"></div>

    <!--
    <table class="sctable">
        <tr>
            <td class="tableId" draggable="true" onclick="onclick_tableId(this)">Users</td>
            <td class="tableHead">Name</td>
            <td class="tableHead">Age</td>
        </tr>
        <tr>
            <td class="tableLhs">1</td>
            <td class="tableCell">Sylvia</td>
            <td class="tableCell">35</td>
        </tr>
        <tr>
            <td class="tableLhs">2</td>
            <td class="tableCell">Laurie</td>
            <td class="tableCell">36</td>
        </tr>
    </table>

    <table class="sctable" style="left:200px;">
        <tr>
            <td class="tableId" draggable="true" onclick="onclick_tableId(this)">Products &#8226;</td>
            <td class="tableHead">Name</td>
            <td class="tableHead">Price</td>
        </tr>
        <tr>
            <td class="tableLhs">1</td>
            <td class="tableCell">Hairbrush</td>
            <td class="tableCell">$5.00</td>
        </tr>
        <tr>
            <td class="tableLhs">2</td>
            <td class="tableCell">Shampoo</td>
            <td class="tableCell">$1.40</td>
        </tr>
    </table>
    -->
</body>
</html>